# 腾讯云部署指南

## 构建命令

在部署前，请先在本地运行构建命令：

```bash
yarn build
```

构建完成后，所有静态文件将位于 `dist/` 目录：
```
dist/
├── index.html
├── css/
│   └── style.css
└── js/
    └── app.js
```

## 部署方案选择

### 方案一：腾讯云服务器（CVM）

#### 1. 创建云服务器
- 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
- 选择 "云服务器 CVM"
- 创建实例（建议 Ubuntu 20.04+）
- 配置安全组：开放 80、443、3000 端口

#### 2. 部署应用
```bash
# 1. 安装 Node.js 和 Yarn
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
npm install -g yarn

# 2. 上传代码
git clone <your-repo>
cd language-converter

# 3. 安装依赖
yarn install

# 4. 配置环境变量
cp .env.example .env
# 编辑 .env 文件，填入您的 API 密钥

# 5. 构建项目
yarn build

# 6. 使用 PM2 启动应用
npm install -g pm2
pm2 start server/app.js --name "language-converter"
pm2 startup
pm2 save
```

#### 3. 配置 Nginx 反向代理
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

### 方案二：腾讯云 Web 应用托管（CloudBase Hosting）

#### 1. 创建应用
- 登录 [云开发控制台](https://console.cloud.tencent.com/tcb)
- 创建环境
- 选择 "Web 应用托管"

#### 2. 连接代码仓库
- 连接 GitHub/GitLab 仓库
- 设置构建设置：
  - **构建命令**: `yarn build`
  - **输出目录**: `dist`
  - **安装命令**: `yarn install`

#### 3. 配置环境变量
在控制台中设置以下环境变量：
```
API_KEY=your_api_key
API_BASE_URL=https://api.openai.com/v1
MODEL_NAME=gpt-3.5-turbo
PORT=3000
NODE_ENV=production
```

#### 4. 部署
- 自动部署：推送代码后自动触发
- 手动部署：点击控制台部署按钮

---

### 方案三：腾讯云函数计算（SCF）

#### 1. 修改代码适配函数计算
需要调整 `server/app.js` 以适配无服务器环境。

#### 2. 使用 Serverless Framework 部署
```bash
npm install -g serverless
serverless create --template tencent-nodejs
```

详细的 Serverless 部署方案需要额外的代码调整。

---

## 常见问题解决

### 1. CSS/JS 文件 404 错误
**问题**: 部署后静态资源无法加载
**解决**:
- 确保运行了 `yarn build` 命令
- 检查 dist/ 目录结构是否包含 css/ 和 js/ 目录
- 确认服务器静态文件服务配置正确

### 2. API 调用失败
**问题**: 前端无法调用后端 API
**解决**:
- 检查 CORS 配置是否正确
- 确认 API 密钥有效
- 检查网络连接和防火墙设置

### 3. 构建失败
**问题**: `yarn build` 命令报错
**解决**:
- 确保 Node.js 版本 >= 16
- 删除 node_modules 重新安装：`rm -rf node_modules && yarn install`
- 检查 public/ 目录是否存在

---

## 生产环境优化建议

1. **启用 Gzip 压缩**
```nginx
gzip on;
gzip_types text/plain application/javascript text/css;
```

2. **设置缓存头**
```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

3. **启用 HTTPS**
使用 Let's Encrypt 免费证书或腾讯云 SSL 证书

4. **监控和日志**
- 使用 PM2 监控：`pm2 monit`
- 查看日志：`pm2 logs`

---

## 推荐部署方案

**对于快速上线**: 使用 **方案二（云开发）**
- 无需管理服务器
- 自动构建和部署
- 支持自动扩容

**对于完全控制**: 使用 **方案一（云服务器）**
- 完全自定义配置
- 成本可控
- 适合长期运营

---

如有问题，请检查构建日志或联系技术支持。
